/*! Talking Image v0.1.0 by Hage Yaapa <captain@hacksparrow.com>. Built on 08-09-2013 */
!function(a){"use strict";function b(a,b){return!b&&a instanceof Array?a:Array.prototype.slice.call(a)}function c(a,b){return void 0!==a?a:b}function d(a,b,e,f){if(a instanceof d){var g=a.slice(b,b+e);return g._littleEndian=c(f,g._littleEndian),g}if(!(this instanceof d))return new d(a,b,e,f);if(this.buffer=a=d.wrapBuffer(a),this._isArrayBuffer=i.ArrayBuffer&&a instanceof ArrayBuffer,this._isPixelData=i.PixelData&&a instanceof CanvasPixelArray,this._isDataView=i.DataView&&this._isArrayBuffer,this._isNodeBuffer=i.NodeBuffer&&a instanceof Buffer,!(this._isNodeBuffer||this._isArrayBuffer||this._isPixelData||a instanceof Array))throw new TypeError("jDataView buffer has an incompatible type");this._littleEndian=!!f;var h="byteLength"in a?a.byteLength:a.length;this.byteOffset=b=c(b,0),this.byteLength=e=c(e,h-b),this._isDataView?this._view=new DataView(a,b,e):this._checkBounds(b,e,h),this._engineAction=this._isDataView?this._dataViewAction:this._isNodeBuffer?this._nodeBufferAction:this._isArrayBuffer?this._arrayBufferAction:this._arrayAction}function e(a){if(i.NodeBuffer)return new Buffer(a,"binary");for(var b=i.ArrayBuffer?Uint8Array:Array,c=new b(a.length),d=0,e=a.length;e>d;d++)c[d]=255&a.charCodeAt(d);return c}function f(a){return a>=0&&31>a?1<<a:f[a]||(f[a]=Math.pow(2,a))}function g(a,b){this.lo=a,this.hi=b}function h(){g.apply(this,arguments)}var i={NodeBuffer:"Buffer"in a&&"readInt16LE"in Buffer.prototype,DataView:"DataView"in a&&("getFloat64"in DataView.prototype||"getFloat64"in new DataView(new ArrayBuffer(1))),ArrayBuffer:"ArrayBuffer"in a,PixelData:"CanvasPixelArray"in a&&"ImageData"in a&&"document"in a};if(i.NodeBuffer&&!function(a){try{a.writeFloatLE(1/0,0)}catch(b){i.NodeBuffer=!1}}(new Buffer(4)),i.PixelData){var j=function(a,b){var c=j.context2d.createImageData((a+3)/4,1).data;if(c.byteLength=a,void 0!==b)for(var d=0;a>d;d++)c[d]=b[d];return c};j.context2d=document.createElement("canvas").getContext("2d")}var k={Int8:1,Int16:2,Int32:4,Uint8:1,Uint16:2,Uint32:4,Float32:4,Float64:8},l={Int8:"Int8",Int16:"Int16",Int32:"Int32",Uint8:"UInt8",Uint16:"UInt16",Uint32:"UInt32",Float32:"Float",Float64:"Double"};d.wrapBuffer=function(a){switch(typeof a){case"number":if(i.NodeBuffer)a=new Buffer(a),a.fill(0);else if(i.ArrayBuffer)a=new Uint8Array(a).buffer;else if(i.PixelData)a=j(a);else{a=new Array(a);for(var c=0;c<a.length;c++)a[c]=0}return a;case"string":a=e(a);default:return"length"in a&&!(i.NodeBuffer&&a instanceof Buffer||i.ArrayBuffer&&a instanceof ArrayBuffer||i.PixelData&&a instanceof CanvasPixelArray)&&(i.NodeBuffer?a=new Buffer(a):i.ArrayBuffer?a instanceof ArrayBuffer||(a=new Uint8Array(a).buffer,a instanceof ArrayBuffer||(a=new Uint8Array(b(a,!0)).buffer)):a=i.PixelData?j(a.length,a):b(a)),a}},d.createBuffer=function(){return d.wrapBuffer(arguments)},d.Uint64=g,g.prototype={valueOf:function(){return this.lo+f(32)*this.hi},toString:function(){return Number.prototype.toString.apply(this.valueOf(),arguments)}},g.fromNumber=function(a){var b=Math.floor(a/f(32)),c=a-b*f(32);return new g(c,b)},d.Int64=h,h.prototype="create"in Object?Object.create(g.prototype):new g,h.prototype.valueOf=function(){return this.hi<f(31)?g.prototype.valueOf.apply(this,arguments):-(f(32)-this.lo+f(32)*(f(32)-1-this.hi))},h.fromNumber=function(a){var b,c;if(a>=0){var d=g.fromNumber(a);b=d.lo,c=d.hi}else c=Math.floor(a/f(32)),b=a-c*f(32),c+=f(32);return new h(b,c)},d.prototype={_offset:0,_bitOffset:0,compatibility:i,_checkBounds:function(a,b,d){if("number"!=typeof a)throw new TypeError("Offset is not a number.");if("number"!=typeof b)throw new TypeError("Size is not a number.");if(0>b)throw new RangeError("Length is negative.");if(0>a||a+b>c(d,this.byteLength))throw new RangeError("Offsets are out of bounds.")},_action:function(a,b,d,e,f){return this._engineAction(a,b,c(d,this._offset),c(e,this._littleEndian),f)},_dataViewAction:function(a,b,c,d,e){return this._offset=c+k[a],b?this._view["get"+a](c,d):this._view["set"+a](c,e,d)},_nodeBufferAction:function(a,b,c,d,e){this._offset=c+k[a];var f=l[a]+("Int8"===a||"Uint8"===a?"":d?"LE":"BE");return c+=this.byteOffset,b?this.buffer["read"+f](c):this.buffer["write"+f](e,c)},_arrayBufferAction:function(b,d,e,f,g){var h,i=k[b],j=a[b+"Array"];if(f=c(f,this._littleEndian),1===i||0===(this.byteOffset+e)%i&&f)return h=new j(this.buffer,this.byteOffset+e,1),this._offset=e+i,d?h[0]:h[0]=g;var l=new Uint8Array(d?this.getBytes(i,e,f,!0):i);return h=new j(l.buffer,0,1),d?h[0]:(h[0]=g,this._setBytes(e,l,f),void 0)},_arrayAction:function(a,b,c,d,e){return b?this["_get"+a](c,d):this["_set"+a](c,e,d)},_getBytes:function(a,d,e){e=c(e,this._littleEndian),d=c(d,this._offset),a=c(a,this.byteLength-d),this._checkBounds(d,a),d+=this.byteOffset,this._offset=d-this.byteOffset+a;var f=this._isArrayBuffer?new Uint8Array(this.buffer,d,a):(this.buffer.slice||Array.prototype.slice).call(this.buffer,d,d+a);return e||1>=a?f:b(f).reverse()},getBytes:function(a,d,e,f){var g=this._getBytes(a,d,c(e,!0));return f?b(g):g},_setBytes:function(a,d,e){var f=d.length;if(0!==f){if(e=c(e,this._littleEndian),a=c(a,this._offset),this._checkBounds(a,f),!e&&f>1&&(d=b(d,!0).reverse()),a+=this.byteOffset,this._isArrayBuffer)new Uint8Array(this.buffer,a,f).set(d);else if(this._isNodeBuffer)(d instanceof Buffer?d:new Buffer(d)).copy(this.buffer,a);else for(var g=0;f>g;g++)this.buffer[a+g]=d[g];this._offset=a-this.byteOffset+f}},setBytes:function(a,b,d){this._setBytes(a,b,c(d,!0))},getString:function(a,b,d){if(this._isNodeBuffer)return b=c(b,this._offset),a=c(a,this.byteLength-b),this._checkBounds(b,a),this._offset=b+a,this.buffer.toString(d||"binary",this.byteOffset+b,this.byteOffset+this._offset);var e=this._getBytes(a,b,!0),f="";a=e.length;for(var g=0;a>g;g++)f+=String.fromCharCode(e[g]);return"utf8"===d&&(f=decodeURIComponent(escape(f))),f},setString:function(a,b,d){return this._isNodeBuffer?(a=c(a,this._offset),this._checkBounds(a,b.length),this._offset=a+this.buffer.write(b,this.byteOffset+a,d||"binary"),void 0):("utf8"===d&&(b=unescape(encodeURIComponent(b))),this._setBytes(a,e(b),!0),void 0)},getChar:function(a){return this.getString(1,a)},setChar:function(a,b){this.setString(a,b)},tell:function(){return this._offset},seek:function(a){return this._checkBounds(a,0),this._offset=a},skip:function(a){return this.seek(this._offset+a)},slice:function(a,b,e){function f(a,b){return 0>a?a+b:a}return a=f(a,this.byteLength),b=f(c(b,this.byteLength),this.byteLength),e?new d(this.getBytes(b-a,a,!0,!0),void 0,void 0,this._littleEndian):new d(this.buffer,this.byteOffset+a,b-a,this._littleEndian)},_getFloat64:function(a,b){var c=this._getBytes(8,a,b),d=1-2*(c[7]>>7),e=((255&c[7]<<1)<<3|c[6]>>4)-1023,g=(15&c[6])*f(48)+c[5]*f(40)+c[4]*f(32)+c[3]*f(24)+c[2]*f(16)+c[1]*f(8)+c[0];return 1024===e?0!==g?0/0:1/0*d:-1023===e?d*g*f(-1074):d*(1+g*f(-52))*f(e)},_getFloat32:function(a,b){var c=this._getBytes(4,a,b),d=1-2*(c[3]>>7),e=(255&c[3]<<1|c[2]>>7)-127,g=(127&c[2])<<16|c[1]<<8|c[0];return 128===e?0!==g?0/0:1/0*d:-127===e?d*g*f(-149):d*(1+g*f(-23))*f(e)},_get64:function(a,b,d){d=c(d,this._littleEndian),b=c(b,this._offset);for(var e=d?[0,4]:[4,0],f=0;2>f;f++)e[f]=this.getUint32(b+e[f],d);return this._offset=b+8,new a(e[0],e[1])},getInt64:function(a,b){return this._get64(h,a,b)},getUint64:function(a,b){return this._get64(g,a,b)},_getInt32:function(a,b){var c=this._getBytes(4,a,b);return c[3]<<24|c[2]<<16|c[1]<<8|c[0]},_getUint32:function(a,b){return this._getInt32(a,b)>>>0},_getInt16:function(a,b){return this._getUint16(a,b)<<16>>16},_getUint16:function(a,b){var c=this._getBytes(2,a,b);return c[1]<<8|c[0]},_getInt8:function(a){return this._getUint8(a)<<24>>24},_getUint8:function(a){return this._getBytes(1,a)[0]},_getBitRangeData:function(a,b){var d=(c(b,this._offset)<<3)+this._bitOffset,e=d+a,f=d>>>3,g=e+7>>>3,h=this._getBytes(g-f,f,!0),i=0;(this._bitOffset=7&e)&&(this._bitOffset-=8);for(var j=0,k=h.length;k>j;j++)i=i<<8|h[j];return{start:f,bytes:h,wideValue:i}},getSigned:function(a,b){var c=32-a;return this.getUnsigned(a,b)<<c>>c},getUnsigned:function(a,b){var c=this._getBitRangeData(a,b).wideValue>>>-this._bitOffset;return 32>a?c&~(-1<<a):c},_setBinaryFloat:function(a,b,c,d,e){var g,h,i=0>b?1:0,j=~(-1<<d-1),k=1-j;0>b&&(b=-b),0===b?(g=0,h=0):isNaN(b)?(g=2*j+1,h=1):1/0===b?(g=2*j+1,h=0):(g=Math.floor(Math.log(b)/Math.LN2),g>=k&&j>=g?(h=Math.floor((b*f(-g)-1)*f(c)),g+=j):(h=Math.floor(b/f(k-c)),g=0));for(var l=[];c>=8;)l.push(h%256),h=Math.floor(h/256),c-=8;for(g=g<<c|h,d+=c;d>=8;)l.push(255&g),g>>>=8,d-=8;l.push(i<<d|g),this._setBytes(a,l,e)},_setFloat32:function(a,b,c){this._setBinaryFloat(a,b,23,8,c)},_setFloat64:function(a,b,c){this._setBinaryFloat(a,b,52,11,c)},_set64:function(a,b,d,e){d instanceof a||(d=a.fromNumber(d)),e=c(e,this._littleEndian),b=c(b,this._offset);var f=e?{lo:0,hi:4}:{lo:4,hi:0};for(var g in f)this.setUint32(b+f[g],d[g],e);this._offset=b+8},setInt64:function(a,b,c){this._set64(h,a,b,c)},setUint64:function(a,b,c){this._set64(g,a,b,c)},_setUint32:function(a,b,c){this._setBytes(a,[255&b,255&b>>>8,255&b>>>16,b>>>24],c)},_setUint16:function(a,b,c){this._setBytes(a,[255&b,255&b>>>8],c)},_setUint8:function(a,b){this._setBytes(a,[255&b])},setUnsigned:function(a,b,c){var d=this._getBitRangeData(c,a),e=d.wideValue,f=d.bytes;e&=~(~(-1<<c)<<-this._bitOffset),e|=(32>c?b&~(-1<<c):b)<<-this._bitOffset;for(var g=f.length-1;g>=0;g--)f[g]=255&e,e>>>=8;this._setBytes(d.start,f,!0)}};var m=d.prototype;for(var n in k)!function(a){m["get"+a]=function(b,c){return this._action(a,!0,b,c)},m["set"+a]=function(b,c,d){this._action(a,!1,b,d,c)}}(n);m._setInt32=m._setUint32,m._setInt16=m._setUint16,m._setInt8=m._setUint8,m.setSigned=m.setUnsigned;for(var o in m)"set"===o.slice(0,3)&&!function(a){m["write"+a]=function(){Array.prototype.unshift.call(arguments,void 0),this["set"+a].apply(this,arguments)}}(o.slice(3));if("undefined"!=typeof module&&"object"==typeof module.exports)module.exports=d;else if("function"==typeof define&&define.amd)define([],function(){return d});else{var p=a.jDataView;(a.jDataView=d).noConflict=function(){return a.jDataView=p,this}}}(function(){return this}()),function(a){"use strict";function b(a){for(var b=1,c=arguments.length;c>b;++b){var d=arguments[b];for(var e in d)void 0!==d[e]&&(a[e]=d[e])}return a}function c(a){return arguments[0]=i(a),b.apply(null,arguments)}function d(a,b,c){return c instanceof Function?c.call(a,b.contexts[0]):c}function e(a,b){return a instanceof e?a.as(b):(a instanceof g||(a=new g(a,void 0,void 0,b?b["jBinary.littleEndian"]:void 0)),this instanceof e?(this.view=a,this.view.seek(0),this.contexts=[],this.as(b,!0)):new e(a,b))}function f(a){return(g=a).prototype.toBinary=function(a){return new e(this,a)},e}"atob"in a&&"btoa"in a||!function(){var b=a,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d=function(){try{document.createElement("$")}catch(a){return a}}();b.btoa||(b.btoa=function(a){for(var b,e,f=0,g=c,h="";a.charAt(0|f)||(g="=",f%1);h+=g.charAt(63&b>>8-8*(f%1))){if(e=a.charCodeAt(f+=.75),e>255)throw d;b=b<<8|e}return h}),b.atob||(b.atob=function(a){if(a=a.replace(/=+$/,""),1==a.length%4)throw d;for(var b,e,f=0,g=0,h="";e=a.charAt(g++);~e&&(b=f%4?64*b+e:e,f++%4)?h+=String.fromCharCode(255&b>>(6&-2*f)):0)e=c.indexOf(e);return h})}();var g,h="function"!=typeof require||"window"in a?function(){}:require,i=Object.create||function(a){var b=function(){};return b.prototype=a,new b},j=e.prototype;j.cacheKey="jBinary.Cache",j.id=0;var k=Object.defineProperty;if(k)try{k({},"x",{})}catch(l){k=null}k||(k=function(a,b,c,d){d&&(a[b]=c.value)}),j._getCached=function(a,b,c){if(a.hasOwnProperty(this.cacheKey))return a[this.cacheKey];var d=b.call(this,a);return k(a,this.cacheKey,{value:d},c),d},j.getContext=function(a){switch(typeof a){case"undefined":a=0;case"number":return this.contexts[a];case"string":return this.getContext(function(b){return a in b});case"function":for(var b=0,c=this.contexts.length;c>b;b++){var d=this.contexts[b];if(a.call(this,d))return d}return}},j.inContext=function(a,b){this.contexts.unshift(a);var c=b.call(this);return this.contexts.shift(),c},e.Type=function(a){return c(e.Type.prototype,a)},e.Type.prototype={inherit:function(a,b){function d(a,b){var d=f[a];d&&(e||(e=c(f)),b.call(e,d),e[a]=null)}var e,f=this;return d("params",function(b){for(var c=0,d=Math.min(b.length,a.length);d>c;c++)this[b[c]]=a[c]}),d("setParams",function(b){b.apply(this,a)}),d("typeParams",function(a){for(var c=0,d=a.length;d>c;c++){var e=a[c],f=this[e];f&&(this[e]=b(f))}}),d("resolve",function(a){a.call(this,b)}),e||f},createProperty:function(a){return c(this,{binary:a})},toValue:function(a,b){return b!==!1&&"string"==typeof a?this.binary.getContext(a)[a]:d(this,this.binary,a)}},e.Template=function(a){return c(e.Template.prototype,a,{createProperty:function(){var b=(a.createProperty||e.Template.prototype.createProperty).apply(this,arguments);return b.getBaseType&&(b.baseType=b.binary.getType(b.getBaseType(b.binary.contexts[0]))),b}})},e.Template.prototype=c(e.Type.prototype,{setParams:function(){this.baseType&&(this.typeParams=["baseType"].concat(this.typeParams||[]))},baseRead:function(){return this.binary.read(this.baseType)},baseWrite:function(a){return this.binary.write(this.baseType,a)}}),e.Template.prototype.read=e.Template.prototype.baseRead,e.Template.prototype.write=e.Template.prototype.baseWrite,j.typeSet={extend:e.Type({setParams:function(){this.parts=arguments},resolve:function(a){for(var b=this.parts,c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=a(b[e]);this.parts=d},read:function(){var a=this.parts,c=this.binary.read(a[0]);return this.binary.inContext(c,function(){for(var d=1,e=a.length;e>d;d++)b(c,this.read(a[d]))}),c},write:function(a){var b=this.parts;this.binary.inContext(a,function(){for(var c=0,d=b.length;d>c;c++)this.write(b[c],a)})}}),"enum":e.Template({params:["baseType","matches"],setParams:function(a,b){this.backMatches={};for(var c in b)this.backMatches[b[c]]=c},read:function(){var a=this.baseRead();return a in this.matches?this.matches[a]:a},write:function(a){this.baseWrite(a in this.backMatches?this.backMatches[a]:a)}}),string:e.Template({params:["length","encoding"],read:function(){return this.binary.view.getString(this.toValue(this.length),void 0,this.encoding)},write:function(a){this.binary.view.writeString(a,this.encoding)}}),string0:e.Type({params:["length","encoding"],read:function(){var a=this.binary.view,b=this.length;if(void 0===b){var c,d=a.tell(),e=0;for(b=a.byteLength-d;b>e&&(c=a.getUint8());)e++;var f=a.getString(e,d,this.encoding);return b>e&&a.skip(1),f}return a.getString(b,void 0,this.encoding).replace(/\0.*$/,"")},write:function(a){var b=this.binary.view,c=void 0===this.length?1:this.length-a.length;b.writeString(a,void 0,this.encoding),c>0&&(b.writeUint8(0),b.skip(c-1))}}),array:e.Template({params:["baseType","length"],read:function(){var a=this.toValue(this.length);if(this.baseType===j.typeSet.uint8)return this.binary.view.getBytes(a,void 0,!0,!0);var b;if(void 0!==a){b=new Array(a);for(var c=0;a>c;c++)b[c]=this.baseRead()}else{var d=this.binary.view.byteLength;for(b=[];this.binary.tell()<d;)b.push(this.baseRead())}return b},write:function(a){if(this.baseType===j.typeSet.uint8)return this.binary.view.writeBytes(a);for(var b=0,c=a.length;c>b;b++)this.baseWrite(a[b])}}),object:e.Type({params:["structure","proto"],resolve:function(a){var b={};for(var c in this.structure)b[c]=this.structure[c]instanceof Function?this.structure[c]:a(this.structure[c]);this.structure=b},read:function(){var a=this,b=this.structure,d=this.proto?c(this.proto):{};return this.binary.inContext(d,function(){for(var c in b){var e=b[c]instanceof Function?b[c].call(a,this.contexts[0]):this.read(b[c]);void 0!==e&&(d[c]=e)}}),d},write:function(a){var b=this,c=this.structure;this.binary.inContext(a,function(){for(var d in c)c[d]instanceof Function?a[d]=c[d].call(b,this.contexts[0]):this.write(c[d],a[d])})}}),bitfield:e.Type({params:["bitSize"],read:function(){return this.binary.view.getUnsigned(this.bitSize)},write:function(a){this.binary.view.writeUnsigned(a,this.bitSize)}}),"if":e.Template({params:["condition","trueType","falseType"],typeParams:["trueType","falseType"],getBaseType:function(){return this.toValue(this.condition)?this.trueType:this.falseType}}),if_not:e.Template({setParams:function(a,b,c){this.baseType=["if",a,c,b]}}),"const":e.Template({params:["baseType","value","strict"],read:function(){var a=this.baseRead();if(this.strict&&a!==this.value){if(this.strict instanceof Function)return this.strict(a);throw new TypeError("Unexpected value.")}return a},write:function(a){this.baseWrite(this.strict||void 0===a?this.value:a)}}),skip:e.Type({setParams:function(a){this.read=this.write=function(){this.binary.view.skip(this.toValue(a))}}}),blob:e.Type({params:["length"],read:function(){return this.binary.view.getBytes(this.toValue(this.length))},write:function(a){this.binary.view.writeBytes(a,!0)}}),binary:e.Template({params:["length","typeSet"],read:function(){var a=this.binary.tell(),b=this.binary.skip(this.toValue(this.length)),c=this.binary.view.slice(a,b);return new e(c,this.typeSet)},write:function(a){this.binary.write("blob",a.read("blob",0))}}),lazy:e.Template({marker:"jBinary.Lazy",params:["innerType","length"],getBaseType:function(){return["binary",this.length,this.binary.typeSet]},read:function(){var a=function(c){return 0===arguments.length?"value"in a?a.value:a.value=a.binary.read(a.innerType):b(a,{wasChanged:!0,value:c}).value};return a[this.marker]=!0,b(a,{binary:b(this.baseRead(),{contexts:this.binary.contexts.slice()}),innerType:this.innerType})},write:function(a){a.wasChanged||!a[this.marker]?this.binary.write(this.innerType,a()):this.baseWrite(a.binary)}})},j.as=function(a,b){var d=b?this:c(this);return a=a||j.typeSet,d.typeSet=j.typeSet===a||j.typeSet.isPrototypeOf(a)?a:c(j.typeSet,a),d.cacheKey=j.cacheKey,d.cacheKey=d._getCached(a,function(){return j.cacheKey+"."+ ++j.id},!0),d};for(var m=["Uint8","Uint16","Uint32","Uint64","Int8","Int16","Int32","Int64","Float32","Float64","Char"],n=e.Type({params:["littleEndian"],read:function(){return this.binary.view["get"+this.dataType](void 0,this.littleEndian)},write:function(a){this.binary.view["write"+this.dataType](a,this.littleEndian)}}),o=0,p=m.length;p>o;o++){var q=m[o];j.typeSet[q.toLowerCase()]=c(n,{dataType:q})}b(j.typeSet,{"byte":j.typeSet.uint8,"float":j.typeSet.float32,"double":j.typeSet.float64}),j.toValue=function(a){return d(this,this,a)},j.seek=function(a,b){if(a=this.toValue(a),void 0!==b){var c=this.view.tell();this.view.seek(a);var d=b.call(this);return this.view.seek(c),d}return this.view.seek(a)},j.tell=function(){return this.view.tell()},j.skip=function(a,b){return this.seek(this.tell()+this.toValue(a),b)},j.getType=function(a,b){switch(typeof a){case"string":if(!(a in this.typeSet))throw new ReferenceError("Unknown type `"+a+"`");return this.getType(this.typeSet[a],b);case"number":return this.getType(j.typeSet.bitfield,[a]);case"object":if(a instanceof e.Type){var c=this;return a.inherit(b||[],function(a){return c.getType(a)})}var d=a instanceof Array;return this._getCached(a,d?function(a){return this.getType(a[0],a.slice(1))}:function(a){return this.getType(j.typeSet.object,[a])},d)}},j.createProperty=function(a){return this.getType(a).createProperty(this)},j._action=function(a,b,c){return void 0!==a?void 0!==b?this.seek(b,c):c.call(this):void 0},j.read=function(a,b){return this._action(a,b,function(){return this.createProperty(a).read(this.contexts[0])})},j.readAll=function(){return this.read("jBinary.all",0)},j.write=function(a,b,c){return this._action(a,c,function(){var c=this.tell();return this.createProperty(a).write(b,this.contexts[0]),this.tell()-c})},j.writeAll=function(a){return this.write("jBinary.all",a,0)},j._toURI="URL"in a&&"createObjectURL"in URL?function(a){var b=this.seek(0,function(){return this.view.getBytes()});return URL.createObjectURL(new Blob([b],{type:a}))}:function(a){var b=this.seek(0,function(){return this.view.getString(void 0,void 0,this.view._isNodeBuffer?"base64":"binary")});return"data:"+a+";base64,"+(this.view._isNodeBuffer?b:btoa(b))},j.toURI=function(a){return this._toURI(a||this.typeSet["jBinary.mimeType"]||"application/octet-stream")},j.slice=function(a,b,c){return new e(this.view.slice(a,b,c),this.typeSet)};var r=h("stream")&&require("stream").Readable;if(e.loadData=function(b,c){if("Blob"in a&&b instanceof Blob){var d=new FileReader;d.onload=d.onerror=function(){c(this.error,this.result)},d.readAsArrayBuffer(b)}else if(r&&b instanceof require("stream").Readable){var e=[];b.on("readable",function(){e.push(this.read())}).on("end",function(){c(null,Buffer.concat(e))}).on("error",c)}else{if("string"!=typeof b)return c(new TypeError("Unsupported source type."));var f=b.match(/^data:(.+?)(;base64)?,(.*)$/);if(f){var i=f[2],j=f[3];try{c(null,i&&g.prototype.compatibility.NodeBuffer?new Buffer(j,"base64"):(i?atob:decodeURIComponent)(j))}catch(k){c(k)}}else if("XMLHttpRequest"in a){var l=new XMLHttpRequest;l.open("GET",b,!0),"responseType"in l?l.responseType="arraybuffer":"overrideMimeType"in l?l.overrideMimeType("text/plain; charset=x-user-defined"):l.setRequestHeader("Accept-Charset","x-user-defined"),"onload"in l||(l.onreadystatechange=function(){4===this.readyState&&this.onload()});var m=function(a){c(new Error(a))};l.onload=function(){return 0!==this.status&&200!==this.status?m("HTTP Error #"+this.status+": "+this.statusText):("response"in this||(this.response=new VBArray(this.responseBody).toArray()),c(null,this.response),void 0)},l.onerror=function(){m("Network error.")},l.send(null)}else{var n=/^(https?):\/\//.test(b);n&&h("request")?require("request").get({uri:b,encoding:null},function(a,b,d){if(!a&&200!==b.statusCode){var e=require("http").STATUS_CODES[b.statusCode];a=new Error("HTTP Error #"+b.statusCode+": "+e)}c(a,d)}):!n&&h("fs")?require("fs").readFile(b,c):c(new TypeError("Unsupported source type."))}}},e.load=function(a,b,c){arguments.length<3&&(c=b,b=void 0),e.loadData(a,function(a,d){a?c(a):c(null,new e(d,b))})},"undefined"!=typeof module&&"object"==typeof module.exports)module.exports=f(require("jdataview"));else if("function"==typeof define&&define.amd)define(["jdataview"],f);else{var s=a.jBinary;(a.jBinary=f(a.jDataView)).noConflict=function(){return a.jBinary=s,this}}}(function(){return this}());var TALKING_IMAGE_VERSION="0.1.0";!function(){window.onload=function(){var a={},b=function(a,b){return b.indexOf(a)>-1?!0:!1},c=function(c,d,e){jBinary.loadData(d,function(f,g){if(!f){for(var h=new jDataView(g),i={format:!1,offset:!1,volume:1},j=0;j<h.byteLength;){if("I"==h.getChar(j)&&"D"==h.getChar(j+1)&&"3"==h.getChar(j+2)&&""==h.getChar(j+3)&&"\x00"==h.getChar(j+4)&&"\x00"==h.getChar(j+5)&&"\x00"==h.getChar(j+6)&&"\x00"==h.getChar(j+7)){i.format="mpeg",i.offset=j;break}if("O"==h.getChar(j)&&"g"==h.getChar(j+1)&&"g"==h.getChar(j+2)&&"S"==h.getChar(j+3)&&"\x00"==h.getChar(j+4)&&""==h.getChar(j+5)&&"\x00"==h.getChar(j+6)&&"\x00"==h.getChar(j+7)&&"\x00"==h.getChar(j+8)&&"\x00"==h.getChar(j+9)&&"\x00"==h.getChar(j+10)&&"\x00"==h.getChar(j+11)&&"\x00"==h.getChar(j+12)&&"\x00"==h.getChar(j+13)){i.format="ogg",i.offset=j;break}j++}if(i.format){h.seek(0),h.getString(i.offset);var k="data:audio/"+i.format+";base64,"+window.btoa(h.getString()),l=new Audio(k);if(b("controls",e)&&l.setAttribute("controls","controls"),b("autoplay",e)&&l.setAttribute("autoplay","true"),b("loop",e)&&l.setAttribute("loop","true"),b("volume",e)){var m=e.split("volume=")[1].split(" ")[0];i.volume=+m,l.volume=+m}b("sync",e)&&(c.setAttribute("src",d),c.style.visibility="visible"),a[d]=l,c.onclick=function(){var b=a[c.getAttribute("src")];if(b.paused)b.play();else{var b=a[c.getAttribute("src")];b.volume=0==b.volume?i.volume:0}}}}})},d=document.getElementsByTagName("img");Array.prototype.forEach.call(d,function(a){var d=a.getAttribute("data-audio"),e=a.getAttribute("src");b("sync",d)&&(a.style.visibility="hidden"),c(a,e,d)})}}();